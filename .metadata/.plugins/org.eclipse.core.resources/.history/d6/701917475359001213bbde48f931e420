package Excel;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Calendar;

import jxl.Workbook;
import jxl.write.Label;
import jxl.write.WritableSheet;
import jxl.write.WritableWorkbook;
import jxl.write.WriteException;
import jxl.write.biff.RowsExceededException;


public class EscrituraExcel {
	LecturaExcel le;
	public EscrituraExcel(){
		
		
	}


        public void EscribirExcel(){
            try{

                    // Aquí se comienza a escribir el constructor de la información

                    WritableWorkbook libro = Workbook.createWorkbook(new File("D:\\Desktop\\pruebaLectura2.xls"));
                    // Para crear el nuevo libro


                    WritableSheet hoja1 = libro.createSheet("hojanueva", 0);

                    //Se crea una hoja dentro del libro de nombre hojanueva en la posición 0.

                    Label label = new Label(1,1,"Este es el mensaje que se muestra"); // Se crea el Label



                    hoja1.addCell(label);// Se escribe el Label en la celda

                    // Para escribir el array de valores en la hoja del libro

                    Label label2=new Label(3, 3, "Escribiendo en columna3 fila3");

                   

                           
                            
							
                    hoja1.addCell(label2);
                   
                    
                    libro.write();
                    libro.close();
            }catch(Exception eP){
                        eP.printStackTrace();
            }
            
    }
        
        @SuppressWarnings("static-access")
		private String nombreDeArchivo(String usuario){
    		String nombre=null;
    		Calendar cal=Calendar.getInstance();
    		int dia=cal.get(cal.DAY_OF_MONTH);
    		int anio=cal.get(cal.YEAR);
    		int mes=cal.get(cal.MONTH)+1;
    		int hora=cal.get(cal.HOUR_OF_DAY);
    		int minuto=cal.get(cal.MINUTE);
    		int segundo=cal.get(cal.SECOND);
    		nombre=usuario+String.valueOf(anio+""+mes+""+dia+""+hora+""+minuto);
    		
    		
    		
    		return nombre;
    		
    	}
        
        
        public String crearExcelDesdeMatriz(ArrayList<ArrayList <String>> matriz,String rutaDestino,String usuario){
        	
        	String contenido=null;
        	int fila=0;
        	int columna=0;
        	
        	
        	
        	 try {
        		//Creando LibroNuevo
				WritableWorkbook libro = Workbook.createWorkbook(new File(rutaDestino+nombreDeArchivo(usuario)+".xls"));
				
				//Creando una hoja para ese libro Nuevo en la posición 0.
				
				WritableSheet hoja1 = libro.createSheet("hojanueva", 0);
				
				
				for(int i=0;i<matriz.size();i++){//comienza primer ciclo
				fila=i;
				
					for(int j=0;j<matriz.get(0).size();j++){//comienza 2do ciclo
						
						columna=j;
						contenido=matriz.get(fila).get(columna);
						
						//Creando etiqueta (contenido de la celda) 
						Label label = new Label(columna,fila,contenido);
						System.out.print(matriz.get(fila).get(columna)+" ");
				
						//Agregando la etiqueta a la celda de la hoja
						hoja1.addCell(label);
				
				
				
				
				}//termina 2do ciclo
					System.out.print("\n");
				
				
			}//termina primer ciclo				
				
					
				//Escribir
				libro.write();
	                    
			    //Cerrar
				libro.close();
					
					
					
					
					
							
				
				
				
			} catch (IOException e) {
				// TODO Auto-generated catch block
				
				System.out.println("Directorio no existe,será creado");
				try{
				File directorio = new File(rutaDestino);
				directorio.mkdir();
				crearExcelDesdeMatriz( matriz,rutaDestino,usuario);
				}catch(Exception e1){
					System.out.println("Imposible escribir en "+rutaDestino);
				}
				
				
			} catch (RowsExceededException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
				System.out.println("RowsExce");
			} catch (WriteException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
				System.out.println("WriteException");
			}
       	
       	 
       	 
       	 
       	 
       	
        	
        	
        	
        	
        	return rutaDestino;
        }
}//Fin Clase


